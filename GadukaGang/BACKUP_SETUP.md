# Настройка автоматической отправки бекапов БД

## Описание

Система автоматически создает резервную копию базы данных и отправляет её всем админам на email каждые 3 часа.

## Ручной запуск

Для тестирования можно запустить команду вручную:

```bash
python manage.py send_backup_to_admins --compress --keep-file
```

Параметры:
- `--compress` - сжать бекап (по умолчанию включено)
- `--keep-file` - сохранить файл после отправки
- `--output backups` - директория для временного хранения

## Автоматический запуск каждые 3 часа

### Windows (Планировщик задач)

1. Откройте Планировщик задач Windows
2. Создайте новую задачу
3. Настройте:
   - **Триггер:** Повторять каждые 3 часа
   - **Действие:** Запустить программу
   - **Программа:** `python`
   - **Аргументы:** `manage.py send_backup_to_admins --compress`
   - **Рабочая папка:** `C:\Users\Mathew\Desktop\техникум\4-й курс\Gaduka Gang\GadukaGang`

Или создайте файл `auto_backup_admins.bat`:

```batch
@echo off
cd /d "C:\Users\Mathew\Desktop\техникум\4-й курс\Gaduka Gang\GadukaGang"
python manage.py send_backup_to_admins --compress
```

И настройте его запуск в планировщике задач.

### Linux (Cron)

Добавьте в crontab:

```bash
crontab -e
```

Добавьте строку:

```cron
0 */3 * * * cd /path/to/GadukaGang && python manage.py send_backup_to_admins --compress
```

Это будет запускать команду каждые 3 часа (в 00:00, 03:00, 06:00, 09:00, 12:00, 15:00, 18:00, 21:00).

## Требования

1. **Настроенный SMTP** - см. `EMAIL_SETUP.md`
2. **Админы с email** - все админы должны иметь указанный email в профиле
3. **PostgreSQL** - должен быть установлен `pg_dump` в PATH

## Получатели

Бекапы отправляются всем пользователям с ролями:
- `admin_level_1`
- `admin_level_2`
- `admin_level_3`
- `super_admin`
- `is_superuser=True`
- `is_staff=True`

У всех должен быть указан email и они должны быть активны.

## Размер файлов

Бекапы сжимаются с помощью gzip для уменьшения размера. Обычно размер составляет:
- Несжатый: 10-50 MB (зависит от размера БД)
- Сжатый: 1-5 MB

## Безопасность

⚠️ **Важно:** Бекапы содержат все данные БД, включая пароли (хэшированные). 
- Храните email-аккаунты админов в безопасности
- Используйте защищенные email-сервисы
- Рассмотрите возможность шифрования бекапов перед отправкой

