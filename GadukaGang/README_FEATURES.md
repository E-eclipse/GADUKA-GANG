# Новые функции

## 1. Удаление тем и сообщений

Теперь пользователи могут удалять свои темы и сообщения:

- **Темы:** Удаление доступно только автору темы через API или веб-интерфейс
- **Сообщения:** Мягкое удаление (is_deleted=True) доступно только автору сообщения

### API Endpoints:
- `DELETE /api/topics/{id}/` - удаление темы (только автор)
- `DELETE /api/posts/{id}/` - удаление сообщения (только автор, мягкое удаление)

## 2. Email-уведомления в сообществах

### Как это работает:
- При создании новой темы в сообществе все участники получают email-уведомление
- При добавлении нового сообщения в тему все участники получают email-уведомление
- Автор темы/сообщения не получает уведомление
- Пользователи могут отключить уведомления через настройки сообщества

### Настройка:
1. Добавьте настройки SMTP в `.env` файл (см. `EMAIL_SETUP.md`)
2. По умолчанию все участники получают уведомления
3. Для отключения используйте кнопку в интерфейсе сообщества

## 3. Автоматическая отправка бекапов админам

Система автоматически создает резервную копию БД и отправляет её всем админам каждые 3 часа.

### Настройка:
1. Убедитесь, что настроен SMTP (см. `EMAIL_SETUP.md`)
2. Убедитесь, что все админы имеют указанный email
3. Настройте автоматический запуск (см. `BACKUP_SETUP.md`)

### Ручной запуск:
```bash
python manage.py send_backup_to_admins --compress
```

### Получатели:
- Все пользователи с ролями: admin_level_1, admin_level_2, admin_level_3, super_admin
- Все superuser и staff пользователи
- У всех должен быть указан email и они должны быть активны

## Настройка переменных окружения

Добавьте в `.env` файл:

```env
# Email настройки (обязательно для работы уведомлений и бекапов)
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USE_TLS=true
EMAIL_HOST_USER=your-email@gmail.com
EMAIL_HOST_PASSWORD=your-app-password
DEFAULT_FROM_EMAIL=noreply@gadukagang.com
SITE_URL=http://127.0.0.1:8000
```

Подробные инструкции:
- `EMAIL_SETUP.md` - настройка email
- `BACKUP_SETUP.md` - настройка автоматических бекапов

