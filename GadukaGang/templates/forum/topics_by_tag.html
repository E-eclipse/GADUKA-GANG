{% extends 'base.html' %}
{% load static %}

{% block title %}Темы с тегом "{{ tag.name }}" - Gaduka Gang{% endblock %}

{% block content %}
<div class="cyber-container">
    <!-- Breadcrumbs -->
    <div class="cyber-breadcrumbs">
        <a href="{% url 'home' %}">
            <i class="fas fa-home"></i> Главная
        </a>
        <span class="breadcrumb-separator">→</span>
        <a href="{% url 'tags_list' %}">
            <i class="fas fa-tags"></i> Теги
        </a>
        <span class="breadcrumb-separator">→</span>
        <span class="current-page">{{ tag.name }}</span>
    </div>

    <!-- Tag Header -->
    <div class="tag-topics-header">
        <div class="tag-topics-header-content">
            <div class="tag-icon-large">
                <i class="fas fa-tag"></i>
            </div>
            <div class="tag-header-info">
                <h1 class="tag-topics-title">
                    <span class="tag-badge-large">{{ tag.name }}</span>
                </h1>
                {% if tag.description %}
                <p class="tag-description">{{ tag.description }}</p>
                {% else %}
                <p class="tag-description">Все темы с тегом "{{ tag.name }}"</p>
                {% endif %}
                <div class="tag-stats">
                    <span class="stat-item">
                        <i class="fas fa-comments"></i>
                        {{ page_obj.paginator.count }} {{ page_obj.paginator.count|pluralize:"тема,темы,тем" }}
                    </span>
                </div>
            </div>
        </div>
        <div class="tag-header-actions">
            <a href="{% url 'tags_list' %}" class="cyber-button secondary">
                <i class="fas fa-tags"></i> Все теги
            </a>
        </div>
    </div>

    <!-- Topics List -->
    <div class="cyber-posts-container">
        {% for topic in page_obj %}
        <div class="topic-block {% if topic.is_pinned %}pinned{% endif %}">
            <div class="topic-header">
                <div class="topic-title">
                    {% if topic.is_pinned %}
                    <span class="pinned-badge">
                        <i class="fas fa-thumbtack"></i> Закреплено
                    </span>
                    {% endif %}
                    <a href="{% url 'topic_detail' topic.id %}">{{ topic.title }}</a>
                </div>
                <div class="topic-stats">
                    <span class="stat-item">
                        <i class="fas fa-eye"></i> {{ topic.view_count }}
                    </span>
                    <span class="stat-item">
                        <i class="fas fa-comment"></i> {{ topic.posts_count }}
                    </span>
                    {% if topic.average_rating > 0 %}
                    <span class="stat-item rating">
                        <i class="fas fa-star"></i> {{ topic.average_rating|floatformat:1 }}
                    </span>
                    {% endif %}
                </div>
            </div>
            <div class="topic-meta">
                <div class="topic-author">
                    <span>Раздел: <a href="{% url 'topics_list' topic.section.id %}" class="section-link">{{ topic.section.name }}</a></span>
                    <span>Автор: <a href="#" class="author-link">{{ topic.author.username }}</a></span>
                    <span>Создано: {{ topic.created_date|date:"d.m.Y H:i" }}</span>
                </div>
            </div>
            <div class="topic-footer">
                <span>Последнее сообщение: {{ topic.last_post_date|date:"d.m.Y H:i" }}</span>
            </div>
        </div>
        {% empty %}
        <div class="empty-state">
            <div class="empty-state-icon">
                <i class="fas fa-tag"></i>
            </div>
            <h3>Нет тем с этим тегом</h3>
            <p>В данный момент нет ни одной темы с тегом "{{ tag.name }}".</p>
            <a href="{% url 'tags_list' %}" class="cyber-button primary">
                <i class="fas fa-tags"></i> Посмотреть все теги
            </a>
        </div>
        {% endfor %}
    </div>

    <!-- Pagination -->
    {% if page_obj.has_other_pages %}
    <div class="pagination">
        <div class="pagination-info">
            Страница {{ page_obj.number }} из {{ page_obj.paginator.num_pages }}
        </div>
        <div class="pagination-controls">
            {% if page_obj.has_previous %}
            <a href="?page=1" class="btn btn-secondary btn-sm">
                <i class="fas fa-angle-double-left"></i>
            </a>
            <a href="?page={{ page_obj.previous_page_number }}" class="btn btn-secondary btn-sm">
                <i class="fas fa-angle-left"></i>
            </a>
            {% endif %}

            {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}" class="btn btn-secondary btn-sm">
                <i class="fas fa-angle-right"></i>
            </a>
            <a href="?page={{ page_obj.paginator.num_pages }}" class="btn btn-secondary btn-sm">
                <i class="fas fa-angle-double-right"></i>
            </a>
            {% endif %}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}