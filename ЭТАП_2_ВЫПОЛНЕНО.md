# –≠–¢–ê–ü 2: –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è - –í–´–ü–û–õ–ù–ï–ù–û ‚úÖ

## üìã –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –û–±–Ω–æ–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

#### requirements.txt
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `django-allauth==0.57.0` - –¥–ª—è OAuth –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `Pillow==10.4.0` - –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏

### 2. –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ django-allauth

#### settings.py - –î–æ–±–∞–≤–ª–µ–Ω–æ:
- ‚úÖ `django.contrib.sites` –≤ INSTALLED_APPS
- ‚úÖ –í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ allauth –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
  - `allauth`
  - `allauth.account`
  - `allauth.socialaccount`
  - `allauth.socialaccount.providers.github`
  - `allauth.socialaccount.providers.google`
- ‚úÖ `SITE_ID = 1` –¥–ª—è allauth
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã AUTHENTICATION_BACKENDS
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã allauth:
  - –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ username –∏–ª–∏ email
  - –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è email
  - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã OAuth –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã (GitHub –∏ Google)
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω email backend (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ - –∫–æ–Ω—Å–æ–ª—å–Ω—ã–π)

### 3. –°–æ–∑–¥–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–æ–ª–µ–π

#### decorators.py - –°–æ–∑–¥–∞–Ω—ã –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã:
- ‚úÖ `@role_required(*allowed_roles)` - —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–æ–ª–µ–π
- ‚úÖ `@moderator_required` - –¥–ª—è –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–≤ –∏ –≤—ã—à–µ
- ‚úÖ `@admin_required` - –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –∏ –≤—ã—à–µ
- ‚úÖ `@admin_level_2_required` - –¥–ª—è –∞–¥–º–∏–Ω–æ–≤ —É—Ä–æ–≤–Ω—è 2 –∏ –≤—ã—à–µ
- ‚úÖ `@admin_level_3_required` - –¥–ª—è –∞–¥–º–∏–Ω–æ–≤ —É—Ä–æ–≤–Ω—è 3 –∏ –≤—ã—à–µ
- ‚úÖ `@super_admin_required` - —Ç–æ–ª—å–∫–æ –¥–ª—è –≥–ª–∞–≤–Ω–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```python
from .decorators import moderator_required

@moderator_required
def my_view(request):
    ...
```

### 4. –°–æ–∑–¥–∞–Ω—ã Mixins –¥–ª—è class-based views

#### mixins.py - –°–æ–∑–¥–∞–Ω—ã mixins:
- ‚úÖ `RoleRequiredMixin` - –±–∞–∑–æ–≤—ã–π mixin –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–æ–ª–µ–π
- ‚úÖ `ModeratorRequiredMixin` - –¥–ª—è –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–≤
- ‚úÖ `AdminRequiredMixin` - –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
- ‚úÖ `AdminLevel2RequiredMixin` - –¥–ª—è –∞–¥–º–∏–Ω–æ–≤ —É—Ä–æ–≤–Ω—è 2
- ‚úÖ `AdminLevel3RequiredMixin` - –¥–ª—è –∞–¥–º–∏–Ω–æ–≤ —É—Ä–æ–≤–Ω—è 3
- ‚úÖ `SuperAdminRequiredMixin` - –¥–ª—è –≥–ª–∞–≤–Ω–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```python
from django.views.generic import View
from .mixins import ModeratorRequiredMixin

class MyView(ModeratorRequiredMixin, View):
    ...
```

### 5. –°–æ–∑–¥–∞–Ω Middleware –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏–π

#### middleware.py - –°–æ–∑–¥–∞–Ω:
- ‚úÖ `AdminActionLoggingMiddleware` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ª–æ–≥–∏—Ä—É–µ—Ç –¥–µ–π—Å—Ç–≤–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –∏ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–≤
- ‚úÖ –õ–æ–≥–∏—Ä—É–µ—Ç POST, PUT, PATCH, DELETE –∑–∞–ø—Ä–æ—Å—ã
- ‚úÖ –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø –¥–µ–π—Å—Ç–≤–∏—è –∏ —Ä–µ—Å—É—Ä—Å
- ‚úÖ –°–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å–∏ –≤ `ModeratorAction`, `AdminLog` –∏ `SystemLog`
- ‚úÖ –ò—Å–∫–ª—é—á–∞–µ—Ç —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ –ø—É—Ç–∏

### 6. –û–±–Ω–æ–≤–ª–µ–Ω—ã URLs

#### urls.py - –î–æ–±–∞–≤–ª–µ–Ω–æ:
- ‚úÖ `path('accounts/', include('allauth.urls'))` - –≤–∫–ª—é—á–∞–µ—Ç –≤—Å–µ URLs –¥–ª—è allauth:
  - `/accounts/login/` - –≤—Ö–æ–¥
  - `/accounts/logout/` - –≤—ã—Ö–æ–¥
  - `/accounts/signup/` - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
  - `/accounts/password/reset/` - –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è
  - `/accounts/email/` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ email
  - `/accounts/github/login/` - –≤—Ö–æ–¥ —á–µ—Ä–µ–∑ GitHub
  - `/accounts/google/login/` - –≤—Ö–æ–¥ —á–µ—Ä–µ–∑ Google
  - –ò –¥—Ä—É–≥–∏–µ...

### 7. –°–æ–∑–¥–∞–Ω–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ OAuth

#### –ò–ù–°–¢–†–£–ö–¶–ò–Ø_OAUTH.md - –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ GitHub OAuth (–ø–æ—à–∞–≥–æ–≤–æ)
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Google OAuth (–ø–æ—à–∞–≥–æ–≤–æ)
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ Client ID –∏ Secret
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ Django
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ Social Application –≤ –∞–¥–º–∏–Ω–∫–µ
- ‚úÖ –†–µ—à–µ–Ω–∏–µ —á–∞—Å—Ç—ã—Ö –ø—Ä–æ–±–ª–µ–º

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- **–ù–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤:** 4 (decorators.py, mixins.py, middleware.py, –ò–ù–°–¢–†–£–ö–¶–ò–Ø_OAUTH.md)
- **–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤:** 3 (settings.py, urls.py, requirements.txt)
- **–î–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–≤:** 6
- **Mixins:** 6
- **OAuth –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤:** 2 (GitHub, Google)

## üîß –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- ‚úÖ –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –≤—Ö–æ–¥
- ‚úÖ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è (—á–µ—Ä–µ–∑ email)
- ‚úÖ –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è email
- ‚úÖ OAuth —á–µ—Ä–µ–∑ GitHub
- ‚úÖ OAuth —á–µ—Ä–µ–∑ Google
- ‚úÖ –°–≤—è–∑—ã–≤–∞–Ω–∏–µ OAuth –∞–∫–∫–∞—É–Ω—Ç–æ–≤

### –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–µ–π —á–µ—Ä–µ–∑ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–µ–π —á–µ—Ä–µ–∑ mixins
- ‚úÖ –ò–µ—Ä–∞—Ä—Ö–∏—è —Ä–æ–ª–µ–π (user < moderator < admin_level_1 < ... < super_admin)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
   ```bash
   cd GadukaGang
   pip install -r requirements.txt
   ```

2. **–ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏:**
   ```bash
   python manage.py migrate
   ```

3. **–°–æ–∑–¥–∞—Ç—å Site –≤ –∞–¥–º–∏–Ω–∫–µ:**
   - –ó–∞–π—Ç–∏ –≤ –∞–¥–º–∏–Ω–∫—É: `/admin/`
   - –ü–µ—Ä–µ–π—Ç–∏ –≤ **Sites** ‚Üí **Sites**
   - –°–æ–∑–¥–∞—Ç—å –∏–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å —Å–∞–π—Ç (–æ–±—ã—á–Ω–æ `example.com`)

4. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å OAuth (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):**
   - –°–ª–µ–¥–æ–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –≤ `–ò–ù–°–¢–†–£–ö–¶–ò–Ø_OAUTH.md`
   - –°–æ–∑–¥–∞—Ç—å OAuth –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ GitHub –∏ Google
   - –î–æ–±–∞–≤–∏—Ç—å Social Application –≤ –∞–¥–º–∏–Ω–∫–µ Django

5. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å email –¥–ª—è production:**
   - –û–±–Ω–æ–≤–∏—Ç—å `EMAIL_BACKEND` –≤ settings.py
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å SMTP —Å–µ—Ä–≤–µ—Ä

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

- [x] –û–±–Ω–æ–≤–ª–µ–Ω requirements.txt
- [x] –ù–∞—Å—Ç—Ä–æ–µ–Ω django-allauth
- [x] –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã OAuth –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã (GitHub, Google)
- [x] –°–æ–∑–¥–∞–Ω—ã –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–æ–ª–µ–π
- [x] –°–æ–∑–¥–∞–Ω—ã mixins –¥–ª—è class-based views
- [x] –°–æ–∑–¥–∞–Ω middleware –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- [x] –û–±–Ω–æ–≤–ª–µ–Ω—ã URLs
- [x] –°–æ–∑–¥–∞–Ω–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ OAuth
- [ ] –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (—Ç—Ä–µ–±—É–µ—Ç—Å—è –≤—ã–ø–æ–ª–Ω–∏—Ç—å –≤—Ä—É—á–Ω—É—é)
- [ ] –ü—Ä–∏–º–µ–Ω–µ–Ω—ã –º–∏–≥—Ä–∞—Ü–∏–∏ (—Ç—Ä–µ–±—É–µ—Ç—Å—è –≤—ã–ø–æ–ª–Ω–∏—Ç—å –≤—Ä—É—á–Ω—É—é)
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã OAuth –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `GadukaGang/GadukaGang/settings.py` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ allauth –∏ OAuth
- `GadukaGang/GadukaGang/urls.py` - URLs –¥–ª—è allauth
- `GadukaGang/GadukaGang/decorators.py` - –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã –¥–ª—è —Ä–æ–ª–µ–π
- `GadukaGang/GadukaGang/mixins.py` - mixins –¥–ª—è —Ä–æ–ª–µ–π
- `GadukaGang/GadukaGang/middleware.py` - middleware –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- `GadukaGang/requirements.txt` - –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- `–ò–ù–°–¢–†–£–ö–¶–ò–Ø_OAUTH.md` - –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ OAuth
- `–ü–õ–ê–ù_–†–ê–ó–†–ê–ë–û–¢–ö–ò.md` - –æ–±–Ω–æ–≤–ª–µ–Ω —Å—Ç–∞—Ç—É—Å —ç—Ç–∞–ø–∞ 2

## üí° –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –î–µ–∫–æ—Ä–∞—Ç–æ—Ä –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–∏-–ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è:
```python
from .decorators import moderator_required

@moderator_required
def moderate_topic(request, topic_id):
    # –¢–æ–ª—å–∫–æ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä—ã –∏ –≤—ã—à–µ –º–æ–≥—É—Ç –∑–∞–π—Ç–∏
    ...
```

### Mixin –¥–ª—è class-based view:
```python
from django.views.generic import ListView
from .mixins import AdminRequiredMixin

class AdminPanelView(AdminRequiredMixin, ListView):
    # –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç –∑–∞–π—Ç–∏
    ...
```

---

*–≠—Ç–∞–ø 2 –≤—ã–ø–æ–ª–Ω–µ–Ω: –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã*

